<tool id="fast_fastq_filter" name="fastq-filter" version="0.1.0" python_template_version="3.5" profile="16.04">
    <description>filter FASTQ reads fast</description>
    <requirements>
        <requirement type="package" version="0.3.0">fastq-filter</requirement>
        <!-- TODO: Remove this once biocontainer is published -->
        <container type="docker">quay.io/rhpvorderman/fastq-filter:0.3.0</container>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        fastq-filter -o '${output1}.gz'
        --verbose
        '$input1'
        mv ${output1.gz} $output1
    ]]></command>
    <inputs>
        <param type="data" name="input1" label="Input FASTQ file" format="fastqsanger,fastqsanger.gz" />
        <param name="minimum_length" type="integer" label="Minimum length"
               optional="true"
               help="The minimum length for a read."/>
        <param name="maximum_length" type="integer" label="Maximum length"
               optional="true"
               help="The maximum length for a read."/>
        <param name="average_error_rate" type="float" label="Average error rate"
               optional="true"
               help="The minimum average per base error rate."/>
        <param name="mean_quality" type="float" label="Mean quality" optional="true">
            <help>
                Average quality. Same as the 'Average error rate' option but
                specified with a phred score. I.e a mean quality of 30 is
                equivalent to an average error rate of 0.001'.
            </help>
        </param>
        <param name="median quality" type="float" label="Median quality"
               optional="true">
            <help>
                DEPRECATED: The minimum median phred score. This is not as
                informative as the average error rate. It is also slower to
                calculate. This filter is only included for backwards
                compatibility reasons.
            </help>
        </param>
    </inputs>
    <outputs>
        <!--Fastqsanger format for now. For conditionally applying fastqsanger.gz the tool needs
         to be updated. An option is using format auto_detect, so we do not have to conditionally set
         fastqsanger or fastqsanger.gz-->
        <data name="output1" format="fastqsanger" />
        <!--When the tool is updated for paired input, the optional paired output can probably be
        found in the cutadapt wrapper -->
    </outputs>
    <tests>
        <test>
            <param name="input1" value="input.fastq.gz"/>
            <output name="output1" file="output.fastq.gz"/>
        </test>
    </tests>
    <help><![CDATA[
    usage: fastq-filter [-h] [-o OUTPUT] [-l MIN_LENGTH] [-L MAX_LENGTH]
                        [-e AVERAGE_ERROR_RATE] [-q MEAN_QUALITY]
                        [-Q MEDIAN_QUALITY] [-c COMPRESSION_LEVEL] [--verbose]
                        [--quiet]
                        input [input ...]

    Filter FASTQ files on various metrics.

    positional arguments:
      input                 Input FASTQ files. Compression format automatically
                            detected. Use - for stdin.

    optional arguments:
      -h, --help            show this help message and exit
      -o OUTPUT, --output OUTPUT
                            Output FASTQ files. Compression format automatically
                            determined by file extension. Flag can be used
                            multiple times. An output must be given for each
                            input. Default: stdout.
      -l MIN_LENGTH, --min-length MIN_LENGTH
                            The minimum length for a read.
      -L MAX_LENGTH, --max-length MAX_LENGTH
                            The maximum length for a read.
      -e AVERAGE_ERROR_RATE, --average-error-rate AVERAGE_ERROR_RATE
                            The minimum average per base error rate.
      -q MEAN_QUALITY, --mean-quality MEAN_QUALITY
                            Average quality. Same as the '--average-error-rate'
                            option but specified with a phred score. I.e '-q 30'
                            is equivalent to '-e 0.001'.
      -Q MEDIAN_QUALITY, --median-quality MEDIAN_QUALITY
                            The minimum median phred score.
      -c COMPRESSION_LEVEL, --compression-level COMPRESSION_LEVEL
                            Compression level for the output files. Relevant when
                            output files have a .gz extension. Default: 2
      --verbose             Report stats on individual filters.
      --quiet               Turn of logging output.
    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubfastq-filter,
  author = {Vorderman, Ruben Harmen Paul},
  year = {2021},
  title = {fastq-filter},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/LUMC/fastq-filter},
}</citation>
    </citations>
</tool>